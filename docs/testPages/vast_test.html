<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RetailSpot test page</title>
  <style type="text/css">
    .fake-text {
      color: gray;
      margin: 16px;
      max-width: 600px;
      margin: auto;
    }

    .centered {
      text-align: center;
    }

    body {
      font-family: arial;
    }

    .setting {
      margin: 20px;
    }
  </style>

</head>

<body>
  <h1>RetailSpot player test page</h1>
  <div>
    Test config:
    <ul>
      <li>RSPlayer version: <b><span id="rsp-version"></span></b></li>

    </ul>
  </div>
  <div>
    <div class="setting">
      <b>Partner ID:</b>
      <input type="text" id="apikey" />
      <br />
      <input type="checkbox" id="rsp_debug" checked disabled />
      <label for="rsp_debug">Debug log</label>
    </div>
    <div class="setting">
      <button onclick="changeTest()">Update Settings</button>
    </div>
    <div class="setting">
      <b>VAST</b>
      <p>Paste a vast XML here:</p>
      <textarea id="vast" style="width:100%;height:130px;">
        <?xml version="1.0"?>
        <VAST version="2.0"><Ad id="1764918"><InLine><AdSystem>LiquidM Technology GmbH</AdSystem><AdTitle>AD-1764918</AdTitle><Error><![CDATA[https://h.lqm.io/vast/error/[ERRORCODE]/1764918]]></Error><Impression><![CDATA[https://h.lqm.io/odin/pixel/768mQVSayhS5MYaItHouT8/site/3i8axzke/ad/1764918/t.gif?gdpr_consent=${GDPR_CONSENT_254}&price=0.1&currency=EUR&mbr=0.01&ts=1670833690054156]]></Impression><Creatives><Creative sequence="1"><Linear><Duration>00:00:08</Duration><TrackingEvents><Tracking event="creativeView"><![CDATA[https://h.lqm.io/action/creativeview/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="start"><![CDATA[https://h.lqm.io/action/start/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="firstQuartile"><![CDATA[https://h.lqm.io/action/firstquartile/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="midpoint"><![CDATA[https://h.lqm.io/action/midpoint/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="thirdQuartile"><![CDATA[https://h.lqm.io/action/thirdquartile/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="complete"><![CDATA[https://h.lqm.io/action/complete/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="mute"><![CDATA[https://h.lqm.io/action/mute/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="unmute"><![CDATA[https://h.lqm.io/action/unmute/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="pause"><![CDATA[https://h.lqm.io/action/pause/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="rewind"><![CDATA[https://h.lqm.io/action/rewind/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="resume"><![CDATA[https://h.lqm.io/action/resume/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="fullscreen"><![CDATA[https://h.lqm.io/action/fullscreen/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="expand"><![CDATA[https://h.lqm.io/action/expand/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="collapse"><![CDATA[https://h.lqm.io/action/collapse/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="acceptInvitation"><![CDATA[https://h.lqm.io/action/acceptinvitation/768mQVSayhS5MYaItHouT8]]></Tracking><Tracking event="close"><![CDATA[https://h.lqm.io/action/close/768mQVSayhS5MYaItHouT8]]></Tracking></TrackingEvents><VideoClicks><ClickThrough><![CDATA[https://h.lqm.io/bid_click_track/768mQVSayhS5MYaItHouT8/site/3i8axzke/ad/1764918?turl=https%3A%2F%2Fwww.smartadserver.com%3Flqmclid%3D768mQVSayhS5MYaItHouT8]]></ClickThrough></VideoClicks><MediaFiles><MediaFile id="1" delivery="progressive" type="video/mp4" bitrate="1221" width="800" height="450"><![CDATA[https://vcdn.lqm.io/crtvs%2F7201b521-e154-4f78-9b11-b640ebc52021.mp4]]></MediaFile></MediaFiles></Linear></Creative></Creatives><Extensions><Extension type="LiquidM" hosted="true"/></Extensions></InLine></Ad></VAST>
      </textarea>
      <button id="clear" onclick="javascript:document.getElementById('vast').value =''">Clear</button>

    </div>
    <div class="setting">
      <button onclick="applyVast()">SHOW AD</button>
    </div>
  </div>
  <div id="target" style="display:flex;justify-content:center;"></div>

  <script type="text/javascript">

    function findGetParameter(parameterName) {
      var result = null,
        tmp = [];
      location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
          tmp = item.split("=");
          if (tmp[0].toLowerCase() === parameterName.toLowerCase()) result = decodeURIComponent(tmp[1]);
        });
      return result;
    }

    function getKeyForValue(array, value, defaultValue) {
      var result = null;
      for (key in array) {
        if (array[key] == value) result = key;
      }

      return result || defaultValue;
    }

    function changeTest() {
      var currentUrl = document.location.href;
      var indexOfQueryStr = currentUrl.lastIndexOf('?');
      if (indexOfQueryStr !== -1) {
        currentUrl = currentUrl.substr(0, indexOfQueryStr);
      }

      var apikey = document.getElementById("apikey").value;

      document.location.href = currentUrl + "?"
        + "&apikey=" + apikey
        + "&rsp_debug=true"
    }
    function applyVast() {
      const RetailSpotConfig = {
        partnerId: apikey,
        vast: document.getElementById("vast").value.trim(),
        width: 320,
        height: 180,
        positionSelector: "#target",
        clickThruEnabled: true,
        closeButton: true,
      }

      window.RetailSpot.init(RetailSpotConfig, function (creative) {
        creative.subscribe(function () {
          console.log("RSPlayer: AdLoaded!");
        }, window.RetailSpot.VPAID_EVENTS.AdLoaded);

        creative.subscribe(function (message) {
          console.error("RSPlayer: ERROR! : " + message);
        }, window.RetailSpot.VPAID_EVENTS.AdError);

        creative.subscribe(function (message) {
          document.getElementById("target").innerHTML = "";
        }, window.RetailSpot.VPAID_EVENTS.AdStopped);
      });
    }

    var apikey = findGetParameter("apikey") || "";
    document.getElementById("apikey").value = apikey;

    var s = document.createElement("script");
    s.src = "https://static-preprod.retailspotads.com/rsplayer.js";
    s.onload = function () {
      document.getElementById("rsp-version").innerText = window.RetailSpot.version;
    }
    document.body.appendChild(s);
  </script>
</body>

</html>